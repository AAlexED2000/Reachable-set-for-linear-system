%%%%%%%% To run this file, you will need to install the CORA toolbox first.
%%%%%%%% reduce order hybrid wind-solar microgrid test code
% State-space System

A_MG = [-37.6991118430775 -0.0558461893471582 -1.41119943948428 14313.7690845103 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 -37.7265365307349 14313.7690845103 1.41119943948428 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;-0.000661336452795294 0 -666733.333333333 313.91063330139 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 666666.666666667 0 0 0 0 0 0 0 0 0;0.000324766038048381 -0.0844444444444444 -313.91063330139 -666733.333333333 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 666666.666666667 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;5.65486677646163e-05 0 0 0 0.0036 0 -5.65486677646163e-05 0 0.00096 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 -37.6991118430775 -0.0623451709635634 0 -2.51332482647623 14310.0895153729 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 -37.7242069362419 0 14310.0895153729 2.51332482647623 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0.000973931707017146 -0.260067344329169 0.247545433329563 -224.405732722607 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 8450926.88942304 0 0 0 -666733.333333333 313.91063330139 0 0 0 0 0 0 0 0 0 0 0 0 0 666665.091126202 1449.38543410607 0 0 0 0 0 0;0 0 0 0 0 -3503010.17614102 0 -0.0844444444444444 0 -313.91063330139 -666733.333333333 0 0 0 0 0 0 0 0 0 0 0 0 0 -1449.38543410607 666665.091126202 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0;5.65486677646163e-05 0 0 0 0 0 0 0 0 0 0 0.009 0 -5.65486677646163e-05 0 0 0 0 0 0.002 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 -37.6991118430775 -0.0843378000679414 5439.00160512678 7846.01258882847 0 0 811.938115578717 -122163.124861324 125417.073686023 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 -37.6697480265794 19523.0307226388 6327.60304952439 0 0 -779.33476914724 -121936.204229923 -116253.559550832 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 15196863.8822686 0 0.0309300136413578 -1010845.84754144 -2069.73984790083 0 0 293.61550835038 240646.834598458 40438.9391055149 0 0 0 0 999883.473851484 15265.6057426014 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 10231889.6709383 0 -0.123369304728504 2190.13229521725 -1013332.31463215 0 0 1575.74358880071 -50195.5448446026 240174.428731186 0 0 0 0 -15265.6057426014 999883.473851484 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -2.45249969902364 -0.5 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 -0.000236240396659473 -8.25351842186171 45.5337372913934 -16.7874954853547 -22.5 -7.59079689675059 178.669053871505 32.3858399346412 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.000157493597772982 5.50234561457447 -30.3558248609289 0 10 3.72719793116706 -119.112702581003 -21.5905599564275 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 -3.09300136413578e-05 10.3058475414406 2.38365048120222 0 0 -0.29361550835038 -240.646834598458 -40.4389391055149 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 -3.29736193816286e-06 -2.50404292851864 12.792314632148 0 0 -1.57574358880071 50.1955448446026 -240.174428731186 0 0 0 0 0 0 0 0 0 0;-0.000661336452795294 0 6278212.66602779 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -12557147.3265122 313.91063330139 -6278212.66602779 0 -6278212.66602779 0 6278212.66602779 0 6278212.66602779 0;0.000324766038048381 0 0 6278212.66602779 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 -313.91063330139 -12557147.3265122 0 -6278212.66602779 0 -6278212.66602779 0 6278212.66602779 0 6278212.66602779;-0.000738943015717296 0 0 0 0 -82039734.227222 0 0 0 6278197.82866064 -13649.3249855414 0 0 0 0 0 0 0 0 0 0 0 -6278212.66602779 0 -12557147.3265122 313.91063330139 -6278212.66602779 0 6278212.66602779 0 6278212.66602779 0;0.000295571415661013 0 0 0 0 32815443.5951679 0 0 0 13649.3249855414 6278197.82866064 0 0 0 0 0 0 0 0 0 0 0 0 -6278212.66602779 -313.91063330139 -12557147.3265122 0 -6278212.66602779 0 6278212.66602779 0 6278212.66602779;-0.000871674719242908 0 0 0 0 0 0 0 0 0 0 0 -96773263.4031057 0 0 6277481.09008626 -95840.7193277868 0 0 0 0 0 -6278212.66602779 0 -6278212.66602779 0 -12557147.3265122 313.91063330139 6278212.66602779 0 6278212.66602779 0;-0.000591129601393171 0 0 0 0 0 0 0 0 0 0 0 -65633286.1139715 0 0 95840.7193277868 6277481.09008626 0 0 0 0 0 0 -6278212.66602779 0 -6278212.66602779 -313.91063330139 -12557147.3265122 0 6278212.66602779 0 6278212.66602779;-0.00190577600446253 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100000000000 0 100000000000 0 100000000000 0 -101110000000 313.91063330139 -100000000000 0;2.45003285602334e-05 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100000000000 0 100000000000 0 100000000000 -313.91063330139 -101110000000 0 -100000000000;-0.000366178183305142 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100000000000 0 100000000000 0 100000000000 0 -100000000000 0 -105776000000 313.91063330139;4.70752375000262e-06 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100000000000 0 100000000000 0 100000000000 0 -100000000000 -313.91063330139 -105776000000];
B_input = [0 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 1000 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;8.71154034415661 0 0 0;130.673105162349 0 0 0;0 0 0 0;0 0 0 0;0 0 0 0;0 0 6278212.66602779 0;0 0 0 6278212.66602779;0 0 6278212.66602779 0;0 0 0 6278212.66602779;0 0 6278212.66602779 0;0 0 0 6278212.66602779;0 0 -100000000000 0;0 0 0 -100000000000;0 0 -100000000000 0;0 0 0 -100000000000];
State_space_Sys = linearSys('linearSys', A_MG,B_input);


% Parameter of reachability

params.tFinal = 1;                      %% simulation time
params.R0 = zonotope([0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0], [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]);
params.U = zonotope([0;0;0;0], [0 0 0 0; ...
                                0 0.29 0 0; ...
                                0 0 0 0; ...
                                0 0 0 0]);  %%wind speed，iph，Iload3d,Iload3q 


% reachable set calculate 

options.linAlg = 'standard';
options.timeStep = 0.001;          %% simulation time step
options.zonotopeOrder = 300;       %% zonotope order upper limit
options.taylorTerms = 1;

reachSet = reach(State_space_Sys ,params, options);


% plot
dims = {9};       %% 9 Vdc  ; 20 wr

for i = 1:length(dims)

    figure(4); hold on; box on
    projDims = dims{i};

    %%% plot reachable sets
    if length(projDims) == 1
        plotOverTime(reachSet, projDims,  'Facecolor', [210,105,30]/255, 'EdgeColor', 'none');   %% RS projected to the time line        
    else
        plot(reachSet, projDims,  'Facecolor', 'magenta', 'EdgeColor', 'none', 'Filled', true);
    end


end

% % plot different projections
% dims = {[9,20]}; %% 9 Vdc  ; 20 wr
% 
% for i = 1:length(dims)
% 
%     figure(5); hold on; box on
%     projDims = dims{i};
% 
%     % plot reachable sets
%     if length(projDims) == 1
%         plotOverTime(reachSet, projDims,  'Facecolor', 'y', 'EdgeColor', 'none');
%     else
%         plot(reachSet, projDims,  'Facecolor', 'magenta', 'EdgeColor', 'none', 'Filled', true);
%     end
% 
% 
% end
toc
